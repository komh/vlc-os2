From c63440138695f43208bd38e742b3f2eb001898d4 Mon Sep 17 00:00:00 2001
From: KO Myung-Hun <komh@chollian.net>
Date: Tue, 2 Jan 2018 18:02:57 +0900
Subject: [PATCH 013/120] Revert "qt: fix setScreen might crash on wayland when
 entering fullscreen"

This reverts commit a7018fc36800b0a3560a4c072c8ec2c3b15776c2.
---
 modules/gui/qt/components/controller.cpp |  9 ---------
 modules/gui/qt/components/controller.hpp |  4 ----
 modules/gui/qt/main_interface.cpp        | 17 +----------------
 modules/gui/qt/main_interface.hpp        |  4 +---
 4 files changed, 2 insertions(+), 32 deletions(-)

diff --git a/modules/gui/qt/components/controller.cpp b/modules/gui/qt/components/controller.cpp
index c25a89bb10..099d2179fc 100644
--- a/modules/gui/qt/components/controller.cpp
+++ b/modules/gui/qt/components/controller.cpp
@@ -813,10 +813,6 @@ FullscreenControllerWidget::FullscreenControllerWidget( intf_thread_t *_p_i, QWi
     b_fullscreen        = false;
     i_hide_timeout      = 1;
     i_screennumber      = -1;
-#ifdef QT5_HAS_WAYLAND
-    b_hasWayland = QGuiApplication::platformName()
-           .startsWith(QLatin1String("wayland"), Qt::CaseInsensitive);
-#endif
 
     vout.clear();
 
@@ -897,12 +893,7 @@ void FullscreenControllerWidget::restoreFSC()
             return;
 
         QRect currentRes = QApplication::desktop()->screenGeometry( targetScreen() );
-#ifdef QT5_HAS_WAYLAND
-        if ( !b_hasWayland )
-            windowHandle()->setScreen(QGuiApplication::screens()[targetScreen()]);
-#else
         windowHandle()->setScreen(QGuiApplication::screens()[targetScreen()]);
-#endif
 
         if( currentRes == screenRes &&
             QApplication::desktop()->screen()->geometry().contains( previousPosition, true ) )
diff --git a/modules/gui/qt/components/controller.hpp b/modules/gui/qt/components/controller.hpp
index 3275108cb1..cbdd74cb05 100644
--- a/modules/gui/qt/components/controller.hpp
+++ b/modules/gui/qt/components/controller.hpp
@@ -325,10 +325,6 @@ private:
 
     bool isWideFSC;
     int i_sensitivity;
-
-#ifdef QT5_HAS_WAYLAND
-    bool b_hasWayland;
-#endif
 };
 
 #endif
diff --git a/modules/gui/qt/main_interface.cpp b/modules/gui/qt/main_interface.cpp
index 0de6626d3d..25b9ee0785 100644
--- a/modules/gui/qt/main_interface.cpp
+++ b/modules/gui/qt/main_interface.cpp
@@ -152,11 +152,6 @@ MainInterface::MainInterface( intf_thread_t *_p_intf ) : QVLCMW( _p_intf )
     /* Should the UI stays on top of other windows */
     b_interfaceOnTop = var_InheritBool( p_intf, "video-on-top" );
 
-#ifdef QT5_HAS_WAYLAND
-    b_hasWayland = QGuiApplication::platformName()
-        .startsWith(QLatin1String("wayland"), Qt::CaseInsensitive);
-#endif
-
     /**************************
      *  UI and Widgets design
      **************************/
@@ -902,12 +897,7 @@ void MainInterface::setVideoFullScreen( bool fs )
 
             QRect screenres = QGuiApplication::screens()[ numscreen ]->geometry();
             lastWinScreen = windowHandle()->screen();
-#ifdef QT5_HAS_WAYLAND
-            if( !b_hasWayland )
-                windowHandle()->setScreen(QGuiApplication::screens()[numscreen]);
-#else
             windowHandle()->setScreen(QGuiApplication::screens()[numscreen]);
-#endif
 
             /* To be sure window is on proper-screen in xinerama */
             if( !screenres.contains( pos() ) )
@@ -933,13 +923,8 @@ void MainInterface::setVideoFullScreen( bool fs )
     {
         setMinimalView( b_minimalView );
         setInterfaceFullScreen( b_interfaceFullScreen );
-#ifdef QT5_HAS_WAYLAND
-        if( lastWinScreen != NULL && !b_hasWayland )
+        if (lastWinScreen != NULL)
             windowHandle()->setScreen(lastWinScreen);
-#else
-        if( lastWinScreen != NULL )
-            windowHandle()->setScreen(lastWinScreen);
-#endif
         if( lastWinPosition.isNull() == false )
         {
             move( lastWinPosition );
diff --git a/modules/gui/qt/main_interface.hpp b/modules/gui/qt/main_interface.hpp
index e7402e68ca..a12dcd3589 100644
--- a/modules/gui/qt/main_interface.hpp
+++ b/modules/gui/qt/main_interface.hpp
@@ -184,9 +184,7 @@ protected:
     bool                 b_pauseOnMinimize;
     bool                 b_maximizedView;
     bool                 b_isWindowTiled;
-#ifdef QT5_HAS_WAYLAND
-    bool                 b_hasWayland;
-#endif
+
     /* States */
     bool                 playlistVisible;       ///< Is the playlist visible ?
 //    bool                 videoIsActive;       ///< Having a video now / THEMIM->hasV
-- 
2.50.1

