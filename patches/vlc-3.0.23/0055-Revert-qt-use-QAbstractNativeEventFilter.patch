From 012c94bd7f95a74df396bf4d003b878d18143985 Mon Sep 17 00:00:00 2001
From: KO Myung-Hun <komh78@gmail.com>
Date: Fri, 26 Dec 2025 15:12:25 +0900
Subject: [PATCH 055/120] Revert "qt: use QAbstractNativeEventFilter"

This reverts commit 9d22c80f819408014be0a24c67059aa22831b712.
---
 modules/gui/qt/components/interface_widgets.cpp |  7 +------
 modules/gui/qt/components/interface_widgets.hpp |  9 ++-------
 modules/gui/qt/main_interface_win32.cpp         |  7 +------
 modules/gui/qt/main_interface_win32.hpp         | 10 ++--------
 4 files changed, 6 insertions(+), 27 deletions(-)

diff --git a/modules/gui/qt/components/interface_widgets.cpp b/modules/gui/qt/components/interface_widgets.cpp
index 95a6df0f95..ce3f29c679 100644
--- a/modules/gui/qt/components/interface_widgets.cpp
+++ b/modules/gui/qt/components/interface_widgets.cpp
@@ -90,7 +90,6 @@ VideoWidget::VideoWidget( intf_thread_t *_p_i, QWidget* p_parent )
     layout->setContentsMargins( 0, 0, 0, 0 );
     stable = NULL;
     p_window = NULL;
-    qApp->installNativeEventFilter(this);
     show();
 }
 
@@ -272,11 +271,7 @@ void VideoWidget::setSize( unsigned int w, unsigned int h )
     sync();
 }
 
-#if QT_VERSION >= QT_VERSION_CHECK(6, 0, 0)
-bool VideoWidget::nativeEventFilter(const QByteArray &eventType, void *message, qintptr *)
-#else
-bool VideoWidget::nativeEventFilter(const QByteArray &eventType, void *message, long *)
-#endif
+bool VideoWidget::nativeEvent( const QByteArray& eventType, void* message, long* )
 {
 #if defined(QT5_HAS_X11)
 # if defined(QT5_HAS_XCB)
diff --git a/modules/gui/qt/components/interface_widgets.hpp b/modules/gui/qt/components/interface_widgets.hpp
index 995b8e0129..c953004d62 100644
--- a/modules/gui/qt/components/interface_widgets.hpp
+++ b/modules/gui/qt/components/interface_widgets.hpp
@@ -43,7 +43,6 @@
 #include <QLabel>
 #include <QMouseEvent>
 #include <QPropertyAnimation>
-#include <QAbstractNativeEventFilter>
 
 class QMenu;
 class QSlider;
@@ -52,7 +51,7 @@ class SpeedControlWidget;
 struct vout_window_t;
 
 /******************** Video Widget ****************/
-class VideoWidget : public QFrame, public QAbstractNativeEventFilter
+class VideoWidget : public QFrame
 {
     Q_OBJECT
 public:
@@ -69,11 +68,7 @@ protected:
         return NULL;
     }
 
-#if QT_VERSION >= QT_VERSION_CHECK(6, 0, 0)
-    bool nativeEventFilter(const QByteArray &eventType, void *message, qintptr *result) override;
-#else
-    bool nativeEventFilter(const QByteArray &eventType, void *message, long *result) override;
-#endif
+    bool nativeEvent(const QByteArray &eventType, void *message, long *result) Q_DECL_OVERRIDE;
     virtual void resizeEvent(QResizeEvent *) Q_DECL_OVERRIDE;
     void mousePressEvent(QMouseEvent *) Q_DECL_OVERRIDE;
     void mouseMoveEvent(QMouseEvent *) Q_DECL_OVERRIDE;
diff --git a/modules/gui/qt/main_interface_win32.cpp b/modules/gui/qt/main_interface_win32.cpp
index 136ad8fd02..c6f687042a 100644
--- a/modules/gui/qt/main_interface_win32.cpp
+++ b/modules/gui/qt/main_interface_win32.cpp
@@ -93,7 +93,6 @@ MainInterfaceWin32::MainInterfaceWin32( intf_thread_t *_p_intf )
     taskbar_wmsg = RegisterWindowMessage(TEXT("TaskbarButtonCreated"));
     if (taskbar_wmsg == 0)
         msg_Warn( p_intf, "Failed to register TaskbarButtonCreated message" );
-    qApp->installNativeEventFilter(this);
 }
 
 MainInterfaceWin32::~MainInterfaceWin32()
@@ -229,11 +228,7 @@ void MainInterfaceWin32::createTaskBarButtons()
         changeThumbbarButtons( THEMIM->getIM()->playingStatus() );
 }
 
-#if QT_VERSION >= QT_VERSION_CHECK(6, 0, 0)
-bool MainInterfaceWin32::nativeEventFilter(const QByteArray &, void *message, qintptr *result)
-#else
-bool MainInterfaceWin32::nativeEventFilter(const QByteArray &, void *message, long *result)
-#endif
+bool MainInterfaceWin32::nativeEvent(const QByteArray &, void *message, long *result)
 {
     MSG * msg = static_cast<MSG*>( message );
 
diff --git a/modules/gui/qt/main_interface_win32.hpp b/modules/gui/qt/main_interface_win32.hpp
index 91e135cfe7..09538d4c29 100644
--- a/modules/gui/qt/main_interface_win32.hpp
+++ b/modules/gui/qt/main_interface_win32.hpp
@@ -27,9 +27,7 @@
 
 #include "main_interface.hpp"
 
-#include <QAbstractNativeEventFilter>
-
-class MainInterfaceWin32 : public MainInterface, public QAbstractNativeEventFilter
+class MainInterfaceWin32 : public MainInterface
 {
     Q_OBJECT
 
@@ -38,11 +36,7 @@ public:
     virtual ~MainInterfaceWin32();
 
 private:
-#if QT_VERSION >= QT_VERSION_CHECK(6, 0, 0)
-    bool nativeEventFilter(const QByteArray &eventType, void *message, qintptr *result) override;
-#else
-    bool nativeEventFilter(const QByteArray &eventType, void *message, long *result) override;
-#endif
+    virtual bool nativeEvent(const QByteArray &eventType, void *message, long *result) Q_DECL_OVERRIDE;
     virtual void toggleUpdateSystrayMenuWhenVisible() Q_DECL_OVERRIDE;
 
 protected:
-- 
2.50.1

